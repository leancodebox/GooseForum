<!DOCTYPE html>
<html lang="zh-CN" {{if .Theme}}data-theme="{{.Theme}}"{{end}}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{template "commonhead.gohtml" .}}
    <meta property="article:published_time" content="{{.PublishedTime}}" />
    <meta property="article:modified_time" content="{{.ModifiedTime}}" />
    <meta property="article:author" content="{{.Username}}" />
    <meta property="article:section" content="{{.Keywords}}" />
    {{GetImportInfoPath `src/detail.js`}}
<script type="application/ld+json">
{{.ArticleJSONLD}}
</script>
</head>
<body>
<div class="min-h-screen flex flex-col bg-base-200">
    <header class="sticky top-0 z-50">
        {{template "nav.gohtml" .}}
    </header>
    <main class="flex-1 container mx-auto px-4 py-4">
        <div class="flex flex-col md:flex-row gap-6">
            <section class="flex-1 space-y-6 min-w-0">
                <!-- 文章详情卡片 -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body overflow-hidden">
                        <h1 class="card-title text-3xl font-normal text-base-content mb-4">
                            {{.ArticleTitle}}
                        </h1>
                        {{if false}}
                            <div class="flex items-center gap-2 mb-4">
                                {{range .ArticleCategory}}
                                    <div class="badge badge-primary">{{.}}</div>
                                    <div class="badge badge-outline">{{.}}</div>
                                {{end}}
                            </div>
                        {{end}}
                        <div class="flex items-center text-base-content/70 mb-6 border-b border-b-gray-200 pb-2">
                            <a class="avatar" href="/user/{{.AuthorId}}">
                                <div class="mask mask-squircle w-8 h-8">
                                    <img src="{{.AvatarUrl}}" alt="{{.Username}}的头像"/>
                                </div>
                            </a>
                            <a  href="/user/{{.AuthorId}}" class="ml-2 mr-4 flex-shrink-0">{{.Username}}</a>
                            <span class="mr-4 flex-shrink-0">{{.CreateTime}}</span>
                            {{if and .User (eq .User.UserId .AuthorId)}}
                                <a href="/publish?id={{.ArticleId}}" class="mr-4 text-primary flex-shrink-0">编辑</a>
                            {{end}}
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                <span class="mr-4">{{.ViewCount}}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none"
                                     viewBox="0 0 24 24"
                                     stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                                <span>{{.LikeCount}}</span>
                            </div>
                        </div>
                        <div class="prose lg:prose-base md:prose-lg
                         prose-h1:font-normal prose-h2:font-normal prose-h3:font-normal
                         prose-a:no-underline
                         prose-pre:bg-base-200
                         prose-code:text-base-content
                         max-w-none text-base-content overflow-hidden min-w-0">
                             {{.ArticleContent}}
                        </div>

                        <!-- 点赞按钮 -->
                        <div class="flex gap-2 mt-6">
                            <button id="like-btn"
                                    class="{{if .ILike}}bg-primary text-primary-content{{else}}bg-base-200 text-base-content{{end}} px-4 py-2 rounded-full text-sm flex items-center gap-2 transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg active:translate-y-0 active:shadow-none"
                                    onclick="toggleLike()"
                                    aria-label="点赞文章">
                                <svg class="w-4 h-4 transition-all duration-300" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                <span id="like-count">{{.LikeCount}}</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 评论区域 -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body overflow-hidden">
                        <h2 class="card-title mb-4">评论</h2>
                        <!-- 发表评论 -->
                        {{if and .User (gt .User.UserId 0)}}
                            <div role="alert" class="alert alert-success alert-dash">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     class="h-6 w-6 shrink-0 stroke-current">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-base-content">讨论应以学习和精进为目的。请勿发布不友善或者负能量的内容，与人为善，比聪明更重要！</span>
                            </div>
                            <div class="mb-6">
                            <textarea id="comment-input" class="textarea textarea-bordered w-full"
                                      placeholder="写下你的评论..."
                                      rows="3"></textarea>
                                <div class="flex justify-between items-center mt-2">
                                    <div class="flex items-center gap-2">
                                        <button class="btn btn-ghost btn-sm" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                                 viewBox="0 0 24 24"
                                                 stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h4a1 1 0 110 2h-1v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6H3a1 1 0 110-2h4z"/>
                                            </svg>
                                            表情
                                        </button>
                                        <button class="btn btn-ghost btn-sm" disabled>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                                 viewBox="0 0 24 24"
                                                 stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.586-6.586a2 2 0 00-2.828-2.828z"/>
                                            </svg>
                                            图片
                                        </button>
                                    </div>
                                    <button id="main-comment-submit" class="btn btn-primary btn-sm">发表评论</button>
                                </div>
                            </div>
                        {{else}}
                            <div class="mt-6 text-center">
                                <a href="/login" class="btn btn-primary btn-sm">登录后发表评论</a>
                            </div>
                        {{end}}

                        <!-- 评论列表 -->
                        <div class="space-y-4">
                            {{range .CommentList}}
                                <div class="flex gap-3" id="reply_{{.Id}}">
                                    <a class="avatar" href="/user/{{.UserId}}">
                                        <div class="mask mask-squircle w-10 h-10">
                                            <img src="{{.UserAvatarUrl}}" alt="{{.Username}}"/>
                                        </div>
                                    </a>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <a class="font-normal text-base-content" href="/user/{{.UserId}}">{{.Username}}</a>
                                            <span class="text-sm text-base-content/60">{{.CreateTime}}</span>
                                        </div>
                                        <p class="text-base-content mb-2">
                                            {{if .ReplyToUsername}}
                                            <a href="/user/{{.ReplyToUserId}}" class="text-primary" class="mr-1">@{{.ReplyToUsername}}</a>
                                            {{end}}
                                            {{Nl2br .Content}}
                                        </p>
                                        <div class="flex items-center gap-4 text-sm text-base-content/60">
                                            <button class="hover:text-primary flex items-center gap-1">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                                     viewBox="0 0 24 24"
                                                     stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                          stroke-width="2"
                                                          d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                                                </svg>
                                                赞
                                            </button>
                                            <button class="hover:text-primary" onclick="showReplyForm({{.Id}})">回复
                                            </button>
                                            <button class="hover:text-primary">举报</button>
                                        </div>

                                        <!-- 回复表单 -->
                                        <div id="reply-form-{{.Id}}" class="reply-form mt-3" style="display: none;">
                                        <textarea class="textarea textarea-bordered w-full comment-input"
                                                  placeholder="写下你的回复..." rows="2"></textarea>
                                            <div class="flex justify-end gap-2 mt-2">
                                                <button class="btn btn-outline btn-sm" onclick="cancelReplyForm()">取消
                                                </button>
                                                <button class="btn btn-primary btn-sm comment-submit"
                                                        onclick="submitReply({{.Id}})">发表回复
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {{end}}
                        </div>

                        <!-- 加载更多评论 -->
                        <div class="text-center mt-6">
                            <button class="btn btn-outline btn-sm">加载更多评论</button>
                        </div>
                    </div>
                </div>
            </section>

            <aside class="w-full md:w-80 flex-shrink-0">
                <div class="sticky top-24 space-y-4">
                    <!-- 作者信息卡片 -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title mb-3 font-normal">作者信息</h2>
                            <div class="flex items-center gap-3 mb-4">
                                <a  href="/user/{{.AuthorId}}" class="avatar">
                                    <div class="mask mask-squircle w-16 h-16">
                                        <img src="{{.AvatarUrl}}" alt="{{.Username}}的头像"/>
                                    </div>
                                </a>
                                <div class="flex-1">
                                    <a href="/user/{{.AuthorId}}" class="font-normal text-base-content">{{.Username}}</a>
                                    <p class="text-sm text-base-content/70">{{.Signature}}</p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <div class="badge badge-xs badge-primary"></div>
                                        <span class="text-xs text-base-content/60">在线</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-base-content/70 mb-2">
                                {{.Bio}}
                            </p>

                            <!-- 数据统计 - 一行展示 -->
                            <div class="grid grid-cols-3 gap-4 mb-1">
                                <div class="text-center">
                                    <div class="text-lg font-normal text-base-content">{{.AuthorInfoStatistics.ArticleCount}}</div>
                                    <div class="text-xs text-base-content/60">文章数</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-normal text-base-content">{{.AuthorInfoStatistics.LikeGivenCount}}</div>
                                    <div class="text-xs text-base-content/60">获赞数</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-normal text-base-content">{{.AuthorInfoStatistics.FollowerCount}}</div>
                                    <div class="text-xs text-base-content/60">粉丝数</div>
                                </div>
                            </div>
                            <hr class="my-1 border-gray-200">
                            <!-- 外站链接 -->
                            <div class="mb-2">
                                <div class="grid grid-cols-4 gap-2 place-items-center">
                                    <!-- GitHub -->
                                    {{if .ExternalInformation.Github.Link}}
                                        <a href="{{.ExternalInformation.Github.Link}}" target="_blank"
                                           class="btn btn-ghost btn-sm btn-square tooltip"
                                           data-tip="GitHub">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30"
                                                 height="30"
                                                 viewBox="0 0 50 50">
                                                <path d="M17.791,46.836C18.502,46.53,19,45.823,19,45v-5.4c0-0.197,0.016-0.402,0.041-0.61C19.027,38.994,19.014,38.997,19,39 c0,0-3,0-3.6,0c-1.5,0-2.8-0.6-3.4-1.8c-0.7-1.3-1-3.5-2.8-4.7C8.9,32.3,9.1,32,9.7,32c0.6,0.1,1.9,0.9,2.7,2c0.9,1.1,1.8,2,3.4,2 c2.487,0,3.82-0.125,4.622-0.555C21.356,34.056,22.649,33,24,33v-0.025c-5.668-0.182-9.289-2.066-10.975-4.975 c-3.665,0.042-6.856,0.405-8.677,0.707c-0.058-0.327-0.108-0.656-0.151-0.987c1.797-0.296,4.843-0.647,8.345-0.714 c-0.112-0.276-0.209-0.559-0.291-0.849c-3.511-0.178-6.541-0.039-8.187,0.097c-0.02-0.332-0.047-0.663-0.051-0.999 c1.649-0.135,4.597-0.27,8.018-0.111c-0.079-0.5-0.13-1.011-0.13-1.543c0-1.7,0.6-3.5,1.7-5c-0.5-1.7-1.2-5.3,0.2-6.6 c2.7,0,4.6,1.3,5.5,2.1C21,13.4,22.9,13,25,13s4,0.4,5.6,1.1c0.9-0.8,2.8-2.1,5.5-2.1c1.5,1.4,0.7,5,0.2,6.6c1.1,1.5,1.7,3.2,1.6,5 c0,0.484-0.045,0.951-0.11,1.409c3.499-0.172,6.527-0.034,8.204,0.102c-0.002,0.337-0.033,0.666-0.051,0.999 c-1.671-0.138-4.775-0.28-8.359-0.089c-0.089,0.336-0.197,0.663-0.325,0.98c3.546,0.046,6.665,0.389,8.548,0.689 c-0.043,0.332-0.093,0.661-0.151,0.987c-1.912-0.306-5.171-0.664-8.879-0.682C35.112,30.873,31.557,32.75,26,32.969V33 c2.6,0,5,3.9,5,6.6V45c0,0.823,0.498,1.53,1.209,1.836C41.37,43.804,48,35.164,48,25C48,12.318,37.683,2,25,2S2,12.318,2,25 C2,35.164,8.63,43.804,17.791,46.836z"></path>
                                            </svg>
                                        </a>
                                    {{end}}
                                    <!-- Twitter/X -->
                                    {{if .ExternalInformation.Twitter.Link}}
                                        <a href="{{.ExternalInformation.Twitter.Link}}" target="_blank"
                                           class="btn btn-ghost btn-sm btn-square tooltip"
                                           data-tip="Twitter">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30"
                                                 height="30"
                                                 viewBox="0 0 50 50">
                                                <path d="M 11 4 C 7.134 4 4 7.134 4 11 L 4 39 C 4 42.866 7.134 46 11 46 L 39 46 C 42.866 46 46 42.866 46 39 L 46 11 C 46 7.134 42.866 4 39 4 L 11 4 z M 13.085938 13 L 21.023438 13 L 26.660156 21.009766 L 33.5 13 L 36 13 L 27.789062 22.613281 L 37.914062 37 L 29.978516 37 L 23.4375 27.707031 L 15.5 37 L 13 37 L 22.308594 26.103516 L 13.085938 13 z M 16.914062 15 L 31.021484 35 L 34.085938 35 L 19.978516 15 L 16.914062 15 z"></path>
                                            </svg>
                                        </a>
                                    {{end}}
                                    {{if .ExternalInformation.LinkedIn.Link}}
                                        <!-- LinkedIn -->
                                        <a href="{{.ExternalInformation.LinkedIn.Link}}" target="_blank"
                                           class="btn btn-ghost btn-sm btn-square tooltip" data-tip="LinkedIn">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30"
                                                 height="30"
                                                 viewBox="0 0 50 50">
                                                <path d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z"></path>
                                            </svg>
                                        </a>
                                    {{end}}
                                    <!-- 微博 -->
                                    {{if .ExternalInformation.Weibo.Link}}
                                        <a href="{{.ExternalInformation.Weibo.Link}}" target="_blank"
                                           class="btn btn-ghost btn-sm btn-square tooltip"
                                           data-tip="微博">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30"
                                                 height="30"
                                                 viewBox="0 0 48 48">
                                                <path fill="#FFF"
                                                      d="M34,29c-0.6-5.8-7.6-9.8-16-8.9c-4.9,0.5-9.4,2.6-11.9,5.6C4.5,27.6,3.8,29.8,4,32c0.5,5.3,6.4,9,13.8,9c0.7,0,1.4,0,2.2-0.1c4.9-0.5,9.4-2.6,11.9-5.6C33.5,33.4,34.2,31.2,34,29z"></path>
                                                <path fill="#D32F2F"
                                                      d="M19.8,38.9C12.7,39.6,6.5,36.4,6,31.8c-0.5-4.6,5-9,12.1-9.7c7.2-0.7,13.3,2.5,13.8,7.1C32.4,33.9,27,38.2,19.8,38.9 M34.7,23.9c-0.6-0.2-1-0.3-0.7-1.1c0.7-1.7,0.8-3.2,0-4.3c-1.4-2-5.3-1.9-9.7-0.1c0,0-1.4,0.6-1-0.5c0.7-2.2,0.6-4-0.5-5C20.4,10.5,14,13,8.5,18.4C4.4,22.5,2,26.8,2,30.5C2,37.7,11.2,42,20.3,42C32.1,42,40,35.2,40,29.8C40,26.5,37.2,24.7,34.7,23.9"></path>
                                                <path fill="#263238"
                                                      d="M20.9,30.4c-0.3,0.5-0.9,0.8-1.4,0.6c-0.5-0.2-0.6-0.8-0.4-1.3c0.3-0.5,0.9-0.8,1.3-0.5C21,29.3,21.1,29.8,20.9,30.4 M17.6,32.8c-0.7,1-2.3,1.5-3.5,1c-1.2-0.5-1.5-1.7-0.8-2.6c0.7-1,2.2-1.4,3.4-1C18,30.6,18.4,31.8,17.6,32.8 M20.5,25.2c-3.5-0.9-7.4,0.8-8.9,3.8c-1.5,3.1-0.1,6.5,3.5,7.6c3.6,1.2,7.9-0.6,9.4-3.9C26,29.5,24.1,26.1,20.5,25.2"></path>
                                                <path fill="#F9A825"
                                                      d="M43.9 20A1.5 1.5 0 1 0 43.9 23A1.5 1.5 0 1 0 43.9 20Z"></path>
                                                <path fill="#F9A825"
                                                      d="M45.3,22C45.3,22,45.3,22,45.3,22c-0.2,0.6-0.8,1-1.4,1c-0.8,0-1.5-0.7-1.5-1.5c0-0.2,0-0.4,0.1-0.6C42.8,20,43,19,43,18c0-5-4-9-9-9c-0.4,0-0.9,0-1.3,0.1c0,0,0,0-0.1,0c0,0-0.1,0-0.1,0c-0.8,0-1.5-0.7-1.5-1.5s0.7-1.5,1.5-1.5c0,0,0,0,0,0C33,6,33.5,6,34,6c6.6,0,12,5.4,12,12C46,19.4,45.8,20.7,45.3,22z M40,18c0-3.3-2.7-6-6-6c-0.2,0-0.4,0-0.7,0c0,0,0,0-0.1,0c-0.7,0.1-1.3,0.7-1.3,1.5c0,0.8,0.7,1.5,1.5,1.5c0,0,0.1,0,0.1,0c0,0,0,0,0,0c0.1,0,0.3,0,0.4,0c1.7,0,3,1.3,3,3c0,0.3-0.1,0.7-0.2,1c0,0,0,0,0,0c-0.1,0.2-0.1,0.3-0.1,0.5c0,0.8,0.7,1.5,1.5,1.5c0.6,0,1.1-0.4,1.4-0.9c0,0,0,0,0,0c0,0,0-0.1,0-0.1c0-0.1,0-0.1,0.1-0.2C39.9,19.2,40,18.6,40,18z"></path>
                                            </svg>
                                        </a>
                                    {{end}}
                                    <!-- 知乎 -->
                                    {{if .ExternalInformation.Zhihu.Link}}
                                        <a href="{{.ExternalInformation.Zhihu.Link}}" target="_blank"
                                           class="btn btn-ghost btn-sm btn-square tooltip" data-tip="知乎">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30"
                                                 height="30"
                                                 viewBox="0 0 32 32">
                                                <path d="M 30.628906 8.9882812 C 30.263281 9.0304687 29.699219 9.1992188 29.699219 9.1992188 C 29.699219 9.1992188 21.499609 10.099219 18.099609 10.199219 C 18.199609 10.699219 18.500391 11.099219 18.900391 11.199219 C 19.600391 11.299219 20.100391 11.199219 21.400391 11.199219 C 22.600391 11.099219 23.599219 11.099609 24.199219 11.099609 L 24.199219 16 L 18 16 C 18 16 18.099219 17.199219 19.199219 17.199219 L 24.199219 17.199219 L 24.199219 20.599609 C 24.199219 21.299609 23.7 21.699219 23 21.699219 C 22.3 21.699219 21.8 21.599609 21 21.599609 C 21.1 21.799609 21.200391 22.299219 21.900391 22.699219 C 22.400391 22.899219 22.699219 23 23.199219 23 C 24.699219 23 25.5 22.099219 25.5 20.699219 L 25.5 17.199219 L 31.599609 17.199219 C 31.999609 17.199219 32.000391 15.999609 31.900391 16.099609 L 25.400391 16.099609 L 25.400391 11.199219 C 25.600391 11.199219 26 11.099609 26.5 11.099609 C 28.6 10.999609 30.000391 10.699219 30.900391 10.699219 C 30.900391 10.699219 31.500391 9.3 30.900391 9 C 30.850391 8.975 30.750781 8.9742188 30.628906 8.9882812 z M 3.3007812 9 C 3.3007813 9 2.0992188 8.9996094 1.6992188 10.099609 C 1.5992187 10.499609 0.9 12.100391 0 13.900391 C 0.3 13.900391 1.2007812 13.800781 1.8007812 12.800781 C 1.9007813 12.500781 2.2007812 12.300391 2.3007812 11.900391 L 3.8007812 11.900391 C 3.8007813 12.400391 3.6992188 15.500781 3.6992188 15.800781 L 1.0996094 15.800781 C 0.49960937 15.800781 0.30078125 17 0.30078125 17 L 3.5 17 C 3.3 19.4 2.1 21.100781 0 22.800781 C 1 23.100781 1.9996094 22.800391 2.5996094 22.400391 C 2.5996094 22.400391 3.8003906 21.499609 4.4003906 19.099609 L 6.9003906 22 C 6.9003906 22 7.3007812 20.6 6.8007812 20 C 6.4007813 19.5 5.5996094 18.599219 5.0996094 18.199219 L 4.4003906 18.800781 C 4.6003906 18.100781 4.8007812 17.7 4.8007812 17 L 8 17 C 8 17 7.9996094 15.800781 7.5996094 15.800781 L 4.9003906 15.800781 C 5.0003906 14.500781 5 13.000391 5 11.900391 L 7.4003906 11.900391 C 7.4003906 11.900391 7.5 10.800781 7 10.800781 L 2.5996094 10.800781 C 2.7996094 10.100781 3.0007813 9.7 3.3007812 9 z M 9 11 L 9 22 L 10.199219 22 L 10.599609 23.300781 L 12.699219 22 L 15 22 L 15 11 L 9 11 z M 29.287109 12.177734 C 29.118359 12.187109 28.950781 12.250391 28.800781 12.400391 L 27 14.800781 L 28 15.5 C 29.1 14.2 30.300781 12.599609 30.300781 12.599609 C 30.300781 12.599609 29.793359 12.149609 29.287109 12.177734 z M 10.199219 12.199219 L 13.699219 12.199219 L 13.699219 20.800781 L 12.5 20.800781 L 11.099609 21.699219 L 10.800781 20.800781 L 10.199219 20.800781 L 10.199219 12.199219 z M 20.128906 12.347656 C 19.707031 12.319531 19.199219 12.599609 19.199219 12.599609 C 19.199219 12.599609 21.200781 15.4 21.300781 15.5 L 22.300781 14.800781 C 22.300781 14.800781 21 13 20.5 12.5 C 20.4 12.4 20.269531 12.357031 20.128906 12.347656 z"></path>
                                            </svg>
                                        </a>
                                    {{end}}
                                    <!-- 知乎 -->
                                    {{if .ExternalInformation.Bilibili.Link}}
                                        <a href="{{.ExternalInformation.Bilibili.Link}}" target="_blank"
                                           class="btn btn-ghost btn-sm btn-square tooltip" data-tip="bilibili">
                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30"
                                                 height="30"
                                                 viewBox="0 0 48 48">
                                                <path fill="#1e88e5"
                                                      d="M36.5,12h-7.086l3.793-3.793c0.391-0.391,0.391-1.023,0-1.414s-1.023-0.391-1.414,0L26.586,12 h-5.172l-5.207-5.207c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L18.586,12H12.5C9.467,12,7,14.467,7,17.5v15 c0,3.033,2.467,5.5,5.5,5.5h2c0,0.829,0.671,1.5,1.5,1.5s1.5-0.671,1.5-1.5h14c0,0.829,0.671,1.5,1.5,1.5s1.5-0.671,1.5-1.5h2 c3.033,0,5.5-2.467,5.5-5.5v-15C42,14.467,39.533,12,36.5,12z M39,32.5c0,1.378-1.122,2.5-2.5,2.5h-24c-1.378,0-2.5-1.122-2.5-2.5 v-15c0-1.378,1.122-2.5,2.5-2.5h24c1.378,0,2.5,1.122,2.5,2.5V32.5z"></path>
                                                <rect width="2.75" height="7.075" x="30.625" y="18.463" fill="#1e88e5"
                                                      transform="rotate(-71.567 32.001 22)"></rect>
                                                <rect width="7.075" height="2.75" x="14.463" y="20.625" fill="#1e88e5"
                                                      transform="rotate(-18.432 17.998 21.997)"></rect>
                                                <path fill="#1e88e5"
                                                      d="M28.033,27.526c-0.189,0.593-0.644,0.896-1.326,0.896c-0.076-0.013-0.139-0.013-0.24-0.025 c-0.013,0-0.05-0.013-0.063,0c-0.341-0.05-0.745-0.177-1.061-0.467c-0.366-0.265-0.808-0.745-0.947-1.477 c0,0-0.29,1.174-0.896,1.49c-0.076,0.05-0.164,0.114-0.253,0.164l-0.038,0.025c-0.303,0.164-0.682,0.265-1.086,0.278 c-0.568-0.051-0.947-0.328-1.136-0.821l-0.063-0.164l-1.427,0.656l0.05,0.139c0.467,1.124,1.465,1.768,2.74,1.768 c0.922,0,1.667-0.303,2.209-0.909c0.556,0.606,1.288,0.909,2.209,0.909c1.856,0,2.55-1.288,2.765-1.843l0.051-0.126l-1.427-0.657 L28.033,27.526z"></path>
                                            </svg>
                                        </a>
                                    {{end}}
                                </div>
                            </div>

                            <div class="card-actions justify-center">
                                <a href="/user/{{.AuthorId}}" class="btn btn-primary btn-sm btn-block">查看主页</a>
                                {{if and .User (gt .User.UserId 0) (not .IsOwnArticle)}}
                                    <button id="follow-btn"
                                            class="btn btn-sm btn-block {{if .IsFollowing}}btn-outline{{else}}btn-secondary{{end}}"
                                            onclick="toggleFollow({{.AuthorId}})"
                                            data-following="{{.IsFollowing}}">
                                        <span id="follow-text">{{if .IsFollowing}}已关注{{else}}关注作者{{end}}</span>
                                        <span id="follow-loading" class="loading loading-spinner loading-xs" style="display: none;"></span>
                                    </button>
                                {{else if not (and .User (gt .User.UserId 0))}}
                                    <a href="/login" class="btn btn-outline btn-sm btn-block">登录后关注</a>
                                {{end}}
                            </div>
                        </div>
                    </div>

                    <!-- 相关推荐 -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title">相关推荐</h2>
                            <div class="space-y-3">
                                {{range .AuthorArticles}}
                                    <div class="hover:bg-base-300 p-2 rounded cursor-pointer">
                                        <a class="text-sm font-normal text-base-content hover:text-primary" href="/post/{{.Id}}">{{.Title}}</a>
                                        <p class="text-xs text-base-content/60 mt-1">0.1k 阅读 · 1秒前</p>
                                    </div>
                                {{end}}
                            </div>
                        </div>
                    </div>

                    <!-- 热门话题 -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title">热门话题</h2>
                            <div class="flex flex-wrap gap-2">
                                {{range .ArticleCategoryList}}
                                <a class="badge badge-outline hover:badge-primary cursor-pointer" href="/post?filters={{.Value}}">#{{.Name}}</a>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>
    {{template "footer.gohtml" .}}
</div>


<script>
    // 页面加载完成后绑定事件
    document.addEventListener('DOMContentLoaded', function () {
        const commentInput = document.getElementById('comment-input');
        const commentSubmit = document.getElementById('main-comment-submit');

        if (commentSubmit && commentInput) {
            commentSubmit.addEventListener('click', async function () {
                const content = commentInput.value.trim();
                if (!content) {
                    alert('请输入评论内容');
                    return;
                }
                // 禁用提交按钮，显示加载状态
                commentSubmit.disabled = true;
                commentSubmit.textContent = '提交中...';
                await submitComment(content, 0);
                // 重置按钮状态
                commentSubmit.disabled = false;
                commentSubmit.textContent = '发表评论';
            });
        }
    });

    function cancelReplyForm() {
        // 隐藏所有回复表单
        document.querySelectorAll('.reply-form').forEach(form => {
            form.style.display = 'none';
        });
    }

    function showReplyForm(commentId) {
        cancelReplyForm()

        // 显示当前评论的回复表单
        const replyForm = document.getElementById(`reply-form-${commentId}`);
        if (replyForm) {
            replyForm.style.display = 'block';
            const textarea = replyForm.querySelector('.comment-input');
            textarea.focus();
        }
    }

    async function submitReply(replyId) {
        const replyForm = document.getElementById(`reply-form-${replyId}`);
        const textarea = replyForm.querySelector('.comment-input');
        const content = textarea.value.trim();

        if (!content) {
            alert('请输入回复内容');
            return;
        }

        const submitBtn = replyForm.querySelector('.comment-submit');
        submitBtn.disabled = true;
        submitBtn.textContent = '提交中...';
        await submitComment(content, replyId);
        submitBtn.disabled = false;
        submitBtn.textContent = '发表回复';
    }

    async function submitComment(content, replyId) {
        try {
            const response = await fetch('/api/forum/articles-reply', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    articleId: {{.ArticleId}},
                    content: content,
                    replyId: replyId
                })
            });

            const result = await response.json();

            if (response.ok) {
                location.reload();
            } else {
                alert(result.msg || '回复发表失败，请稍后重试');
            }
        } catch (error) {
            console.error('回复发表失败:', error);
            alert('回复发表失败，请稍后重试');
        }
    }

    async function toggleLike() {
        const likeBtn = document.getElementById('like-btn');
        const likeCountSpan = document.getElementById('like-count');
        const currentCount = parseInt(likeCountSpan.textContent);
        const isLiked = likeBtn.classList.contains('bg-primary');
        const action = isLiked ? 2 : 1;

        try {
            const response = await fetch('/api/forum/like-articles', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: {{.ArticleId}},
                    action: action
                })
            });

            const result = await response.json();

            if (response.ok) {
                if (action === 1) {
                    likeBtn.classList.remove('bg-base-200', 'text-base-content');
                    likeBtn.classList.add('bg-primary', 'text-primary-content');
                    likeCountSpan.textContent = currentCount + 1;
                } else {
                    likeBtn.classList.remove('bg-primary', 'text-primary-content');
                    likeBtn.classList.add('bg-base-200', 'text-base-content');
                    likeCountSpan.textContent = currentCount - 1;
                }
            } else {
                alert(result.msg || '操作失败，请稍后重试');
            }
        } catch (error) {
            console.error('操作失败:', error);
            alert('操作失败，请稍后重试');
        }
    }

    // 关注/取消关注功能
    async function toggleFollow(authorId) {
        const followBtn = document.getElementById('follow-btn');
        const followText = document.getElementById('follow-text');
        const followLoading = document.getElementById('follow-loading');

        if (!followBtn) return;

        const isFollowing = followBtn.getAttribute('data-following') === 'true';
        const action = isFollowing ? 2 : 1; // 1: 关注, 2: 取消关注

        // 显示加载状态
        followText.style.display = 'none';
        followLoading.style.display = 'inline-block';
        followBtn.disabled = true;

        try {
            const response = await fetch('/api/forum/follow-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: authorId,
                    action: action
                })
            });

            const result = await response.json();

            if (response.ok && result.code === 0) {
                // 更新按钮状态
                if (action === 1) {
                    // 关注成功
                    followBtn.classList.remove('btn-secondary');
                    followBtn.classList.add('btn-outline');
                    followText.textContent = '已关注';
                    followBtn.setAttribute('data-following', 'true');
                } else {
                    // 取消关注成功
                    followBtn.classList.remove('btn-outline');
                    followBtn.classList.add('btn-secondary');
                    followText.textContent = '关注作者';
                    followBtn.setAttribute('data-following', 'false');
                }
            } else {
                alert(result.msg || '操作失败，请稍后重试');
            }
        } catch (error) {
            console.error('关注操作失败:', error);
            alert('操作失败，请稍后重试');
        } finally {
            // 恢复按钮状态
            followText.style.display = 'inline-block';
            followLoading.style.display = 'none';
            followBtn.disabled = false;
        }
    }
</script>

</body>
</html>
